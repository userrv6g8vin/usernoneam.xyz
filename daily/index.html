<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>สรุปรายวัน - usernoneam.xyz</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<style>
 body{font-family: 'Prompt',system-ui,sans-serif;background:#f8fafc;}
 .day-row:hover{background:#f9fafb;}
 .metric-badge{font-size:10px;letter-spacing:.5px;}
 .fade-in{animation:fade .35s ease;}
 @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
 .bar-bg{height:6px;background:#e5e7eb;border-radius:4px;overflow:hidden;}
 .bar-fill{height:100%;background:linear-gradient(90deg,#2563eb,#3b82f6);} 
  /* Modern Clean Modal */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(248, 250, 252, 0.85);
    backdrop-filter: blur(24px) saturate(150%);
    -webkit-backdrop-filter: blur(24px) saturate(150%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    animation: fadeIn 0.35s ease forwards;
  }
  @keyframes fadeIn { to { opacity: 1; } }
  .modal-content {
    background: #fff;
    border-radius: 32px;
    padding: 48px 40px;
    max-width: 420px;
    width: calc(100% - 48px);
    box-shadow: 0 24px 72px rgba(0,0,0,0.06), 0 12px 32px rgba(0,0,0,0.04), 0 0 0 1px rgba(0,0,0,0.02);
    transform: scale(0.9) translateY(30px);
    opacity: 0;
    animation: modalSlideUp 0.5s cubic-bezier(0.16,1,0.3,1) 0.08s forwards;
    text-align: center;
  }
  @keyframes modalSlideUp { to { transform: scale(1) translateY(0); opacity: 1; } }
  .modal-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 8px;
  }
  .modal-icon {
    width: 88px; height: 88px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center;
    background: linear-gradient(135deg,#fff1f2 0%,#ffe4e6 100%);
    box-shadow: 0 12px 32px rgba(239,68,68,0.08), inset 0 2px 0 rgba(255,255,255,0.9);
    margin: 0 auto 24px;
  }
  .modal-icon svg { width: 32px; height: 32px; color: #ef4444; }
  .modal-title { font-size: 22px; font-weight: 700; color: #0f172a; margin: 0 0 12px 0; letter-spacing: -0.03em; }
  .modal-message { color: #64748b; font-size: 15px; line-height: 1.6; margin-bottom: 36px; font-weight: 400; }
  .modal-actions { display: flex; gap: 14px; justify-content: center; }
  .modal-btn { flex: 1; padding: 16px 32px; border: none; border-radius: 18px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s cubic-bezier(0.16,1,0.3,1); font-family: 'Prompt',sans-serif; letter-spacing: -0.01em; }
  .modal-btn-cancel { background: #fff; color: #64748b; border: 2px solid #e2e8f0; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
  .modal-btn-cancel:hover { background: #f8fafc; color: #475569; border-color: #cbd5e1; transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.06); }
  .modal-btn-confirm { background: #ef4444; color: white; border: 2px solid #ef4444; box-shadow: 0 4px 16px rgba(239,68,68,0.25); }
</style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800">
  <div class="max-w-3xl mx-auto px-4 py-6">
    <div class="mb-6 flex items-center justify-between">
      <div>
        <h1 class="text-lg font-bold tracking-tight text-gray-900">สรุปรายวัน</h1>
        <p class="text-xs text-gray-500">รวมยอดฝาก ถอน และกำไร แยกตามวัน (อิงจากการใช้งานบนอุปกรณ์นี้)</p>
      </div>
      <a href="/store1/" class="text-xs text-blue-600 hover:text-blue-700 inline-flex items-center gap-1">
        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
        กลับ
      </a>
    </div>

    <div class="flex items-center justify-between mb-4 gap-3">
      <div class="flex gap-2 text-xs">
        <button id="btnFilter7" class="px-3 py-1 rounded-lg bg-white border border-gray-200 hover:border-blue-400 hover:text-blue-600">7 วัน</button>
        <button id="btnFilter14" class="px-3 py-1 rounded-lg bg-white border border-gray-200 hover:border-blue-400 hover:text-blue-600">14 วัน</button>
        <button id="btnFilter30" class="px-3 py-1 rounded-lg bg-white border border-gray-200 hover:border-blue-400 hover:text-blue-600">30 วัน</button>
      </div>
      <div class="flex items-center gap-2">
        <button id="btnClearAllDaily" class="text-red-500 hover:underline bg-transparent border-none p-0 m-0 font-semibold" style="font-size:15px;">ล้างทั้งหมด</button>
      </div>
    </div>
    <div id="dailySummaryContainer" class="space-y-4"></div>

    <div class="mt-10 text-[11px] text-gray-400 leading-relaxed">
      ข้อมูลทั้งหมดเก็บใน <code>localStorage</code> ของอุปกรณ์นี้เท่านั้น ไม่ถูกส่งไปยังเซิร์ฟเวอร์ หากล้างข้อมูลบราวเซอร์หรือใช้เครื่องอื่นจะไม่เห็นประวัติเดิม
    </div>
  </div>

<script>

(function(){
  const container = document.getElementById('dailySummaryContainer');
  // Read both store1 and store2 daily data
  const dailyData1Raw = localStorage.getItem('dailyData1');
  const dailyData2Raw = localStorage.getItem('dailyData2');
  let dailyData1 = dailyData1Raw ? JSON.parse(dailyData1Raw) : {};
  let dailyData2 = dailyData2Raw ? JSON.parse(dailyData2Raw) : {};

  const savedFilter = Number(sessionStorage.getItem('dailyFilterDays')) || 30;

  function segStats(entries){
    let s = {morning:{ops:0,dep:0,wd:0},afternoon:{ops:0,dep:0,wd:0},night:{ops:0,dep:0,wd:0}};
    entries.forEach(e=>{
      const h = new Date(e.ts).getHours();
      const dep = e.deltaDeposit||0; const wd = e.deltaWithdrawal||0;
      if(h>=8 && h<12){ s.morning.ops++; s.morning.dep+=dep; s.morning.wd+=wd; }
      else if(h>=12 && h<20){ s.afternoon.ops++; s.afternoon.dep+=dep; s.afternoon.wd+=wd; }
      else { s.night.ops++; s.night.dep+=dep; s.night.wd+=wd; }
    });
    return s;
  }

  function amountFrequency(entries){
    const freq = {};
    entries.forEach(e=>{
      const dep = e.deltaDeposit||0;
      if(dep>0){ freq[dep] = (freq[dep]||0)+1; }
    });
    return Object.entries(freq).sort((a,b)=> b[1]-a[1] || Number(a[0])-Number(b[0]));
  }

  function buildOverview(keys, dailyData, label){
    const totalOpsAll = keys.reduce((acc,k)=> acc + (dailyData[k]||[]).length,0);
    const totalProfitAll = keys.reduce((acc,k)=>{
      const entries = dailyData[k]||[]; let d=0,w=0; entries.forEach(e=>{d+=e.deltaDeposit||0; w+=e.deltaWithdrawal||0;}); return acc + (d-w);
    },0);
    const avgOps = (totalOpsAll/keys.length)||0;
    return `<div class="bg-white border border-blue-100 rounded-xl p-5 mb-2 shadow-sm">
      <div class="flex items-center justify-between mb-3">
        <div class="text-sm font-semibold text-blue-700">${label} - ภาพรวม ${keys.length} วันล่าสุด</div>
        <div class="text-[10px] text-gray-500">ข้อมูลไม่ sync ข้ามอุปกรณ์</div>
      </div>
      <div class="grid grid-cols-4 gap-3 text-center text-xs">
        <div class="bg-blue-50 rounded-lg p-3">
          <div class="font-bold text-blue-700">${totalOpsAll}</div>
          <div class="text-blue-600">จำนวนครั้งทั้งหมด</div>
        </div>
        <div class="bg-green-50 rounded-lg p-3">
          <div class="font-bold text-green-700">${totalProfitAll.toFixed(2)}</div>
          <div class="text-green-600">กำไรรวม</div>
        </div>
        <div class="bg-gray-50 rounded-lg p-3">
          <div class="font-bold text-gray-700">${avgOps.toFixed(1)}</div>
          <div class="text-gray-600">เฉลี่ยครั้ง/วัน</div>
        </div>
        <div class="bg-indigo-50 rounded-lg p-3">
          <div class="font-bold text-indigo-700">${(totalProfitAll/(totalOpsAll||1)).toFixed(2)}</div>
          <div class="text-indigo-600">กำไร/ครั้ง (รวม)</div>
        </div>
      </div>
    </div>`;
  }

  function buildRows(keys, dailyData){
    return keys.map(dayKey=>{
      const entries = dailyData[dayKey] || [];
      let sumDeposit = 0, sumWithdrawal = 0;
      entries.forEach(e=>{ sumDeposit += (e.deltaDeposit||0); sumWithdrawal += (e.deltaWithdrawal||0); });
      const dayProfit = sumDeposit - sumWithdrawal;
      const ops = entries.length;
      const peak = entries.reduce((acc,e)=>{const p=(e.deltaDeposit||0)-(e.deltaWithdrawal||0);return p>acc?p:acc;},0);
      const negCount = entries.reduce((acc,e)=>{const p=(e.deltaDeposit||0)-(e.deltaWithdrawal||0);return p<0?acc+1:acc;},0);
      const seg = segStats(entries);
      const freqArr = amountFrequency(entries).slice(0,8);
      const maxOps = Math.max(...keys.map(k=> (dailyData[k]||[]).length));
      const opsPercent = maxOps? (ops/maxOps)*100 : 0;
      return `<div class=\"bg-white shadow-sm border border-gray-100 rounded-xl p-4 fade-in day-row\">
        <div class=\"flex items-start justify-between mb-3\">
          <div class=\"space-y-0.5\">
            <div class=\"text-sm font-semibold text-gray-800\">${dayKey}</div>
            <div class=\"flex gap-2 flex-wrap\">
              <span class=\"px2 py-0.5 text-[10px] font-medium text-blue-600\">ปรับ ${ops} ครั้ง</span>
              <span class=\"px2 py-0.5 text-[10px] font-medium ${dayProfit>=0?'text-green-600':'text-red-600'}\">กำไร ${dayProfit.toFixed(2)}</span>
              <span class=\"px2 py-0.5 text-[10px] font-medium text-gray-500\">ติดลบเดลต้า ${negCount} ครั้ง</span>
            </div>
          </div>
          <div class=\"text-right text-xs\">
            <div class=\"font-medium text-gray-700\">ฝากรวม: <span class=\"text-gray-900\">${sumDeposit.toFixed(2)}</span></div>
            <div class=\"font-medium text-gray-700\">ถอนรวม: <span class=\"text-gray-900\">${sumWithdrawal.toFixed(2)}</span></div>
            <button data-clear-day=\"${dayKey}\" class=\"mt-1 text-[10px] text-red-500 hover:text-red-600 underline\">เคลียร์วัน</button>
          </div>
        </div>
        <div class=\"mb-2 text-[10px] text-gray-500\">สัดส่วนจำนวนครั้งเทียบวันที่อื่น</div>
        <div class=\"bar-bg\"><div class=\"bar-fill\" style=\"width:${opsPercent.toFixed(1)}%\"></div></div>
        <div class=\"mt-3 grid grid-cols-4 gap-2 text-[10px]\">
          <div class=\"p-2 rounded-lg bg-gray-50 text-center\">
            <div class=\"font-semibold ${peak>=0?'text-green-600':'text-red-600'}\">${peak.toFixed(2)}</div>
            <div class=\"text-gray-500\">เดลต้าสูงสุด</div>
          </div>
          <div class=\"p-2 rounded-lg bg-gray-50 text-center\">
            <div class=\"font-semibold\">${(sumDeposit/ops||0).toFixed(2)}</div>
            <div class=\"text-gray-500\">ฝาก/ครั้ง</div>
          </div>
          <div class=\"p-2 rounded-lg bg-gray-50 text-center\">
            <div class=\"font-semibold\">${(sumWithdrawal/ops||0).toFixed(2)}</div>
            <div class=\"text-gray-500\">ถอน/ครั้ง</div>
          </div>
          <div class=\"p-2 rounded-lg bg-gray-50 text-center\">
            <div class=\"font-semibold\">${((dayProfit)/(ops||1)).toFixed(2)}</div>
            <div class=\"text-gray-500\">กำไร/ครั้ง</div>
          </div>
        </div>
        <div class=\"mt-4 grid md:grid-cols-3 gap-3 text-[10px]\">
          <div class=\"p-2 rounded-lg border border-gray-100\">
            <div class=\"font-semibold mb-1 text-gray-700\">08:00 - 12:00</div>
            <div>ครั้ง: ${seg.morning.ops}</div>
            <div>ฝากรวม: ${seg.morning.dep.toFixed(2)}</div>
            <div>ถอนรวม: ${seg.morning.wd.toFixed(2)}</div>
          </div>
          <div class=\"p-2 rounded-lg border border-gray-100\">
            <div class=\"font-semibold mb-1 text-gray-700\">12:00 - 20:00</div>
            <div>ครั้ง: ${seg.afternoon.ops}</div>
            <div>ฝากรวม: ${seg.afternoon.dep.toFixed(2)}</div>
            <div>ถอนรวม: ${seg.afternoon.wd.toFixed(2)}</div>
          </div>
          <div class=\"p-2 rounded-lg border border-gray-100\">
            <div class=\"font-semibold mb-1 text-gray-700\">20:00 - 08:00</div>
            <div>ครั้ง: ${seg.night.ops}</div>
            <div>ฝากรวม: ${seg.night.dep.toFixed(2)}</div>
            <div>ถอนรวม: ${seg.night.wd.toFixed(2)}</div>
          </div>
        </div>
        <div class=\"mt-4\">
          <div class=\"text-[10px] font-semibold text-gray-600 mb-1\">จำนวนครั้งเดลต้ายอดฝากที่ใช้บ่อย (สูงสุด 8)</div>
          <div class=\"flex flex-wrap gap-2\">
            ${freqArr.length? freqArr.map(([amt,c])=>`<div class='px-2 py-1 rounded-md bg-blue-50 text-blue-700 text-[10px]'>${amt} : ${c} ครั้ง</div>`).join('') : '<div class=\"text-[10px] text-gray-400\">ไม่มีข้อมูล</div>'}
          </div>
        </div>
      </div>`;
    }).join('');
  }

  function render(){
    // Prepare keys
    const dateKeys1 = Object.keys(dailyData1).sort((a,b)=> b.localeCompare(a));
    const dateKeys2 = Object.keys(dailyData2).sort((a,b)=> b.localeCompare(a));
    const limitedKeys1 = dateKeys1.slice(0, savedFilter);
    const limitedKeys2 = dateKeys2.slice(0, savedFilter);

    let html = '';
    html += `<section class='mb-8'>
      <div class='flex items-center gap-3 mb-2'>
        <span class='inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-100 text-gray-700 text-lg font-bold shadow-sm'>1</span>
        <span class='text-lg font-bold text-gray-900 tracking-tight'>ชั้น 1 <span class='font-normal text-gray-500'>(store1)</span></span>
      </div>
      <div class='mb-3 text-xs text-gray-500'>รวมข้อมูลการฝาก ถอน และกำไรของชั้น 1</div>
      <div class='rounded-xl border border-gray-200 bg-white p-4 shadow-sm'>
        ${dateKeys1.length === 0 ? '<div class="text-center text-sm text-gray-400 py-8">ยังไม่มีข้อมูลรายวัน</div>' : buildOverview(limitedKeys1, dailyData1, 'ชั้น 1') + buildRows(limitedKeys1, dailyData1)}
      </div>
    </section>`;
    html += `<section>
      <div class='flex items-center gap-3 mb-2'>
        <span class='inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-100 text-gray-700 text-lg font-bold shadow-sm'>2</span>
        <span class='text-lg font-bold text-gray-900 tracking-tight'>ชั้น 2 <span class='font-normal text-gray-500'>(store2)</span></span>
      </div>
      <div class='mb-3 text-xs text-gray-500'>รวมข้อมูลการฝาก ถอน และกำไรของชั้น 2</div>
      <div class='rounded-xl border border-gray-200 bg-white p-4 shadow-sm'>
        ${dateKeys2.length === 0 ? '<div class="text-center text-sm text-gray-400 py-8">ยังไม่มีข้อมูลรายวัน</div>' : buildOverview(limitedKeys2, dailyData2, 'ชั้น 2') + buildRows(limitedKeys2, dailyData2)}
      </div>
    </section>`;
    container.innerHTML = html;

    // Per day clear buttons for both stores
    container.querySelectorAll('button[data-clear-day]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const day = btn.getAttribute('data-clear-day');
        // Determine which store
        const parent = btn.closest('.day-row').parentElement.previousElementSibling;
        let store = 'dailyData1';
        if(btn.closest('.day-row').parentElement.parentElement.querySelector('h2').textContent.includes('ชั้น 2')){
          store = 'dailyData2';
        }
        showClearModal('ลบข้อมูลของวัน '+day+' ?', ()=>{
          if(store === 'dailyData1'){
            delete dailyData1[day];
            localStorage.setItem('dailyData1', JSON.stringify(dailyData1));
          }else{
            delete dailyData2[day];
            localStorage.setItem('dailyData2', JSON.stringify(dailyData2));
          }
          location.reload();
        });
      });
    });
  }

  render();

  // Global clear
  document.getElementById('btnClearAllDaily').addEventListener('click',()=>{
    showClearModal('เคลียร์ข้อมูลรายวันทั้งหมด?', ()=>{
      localStorage.removeItem('dailyData1');
      localStorage.removeItem('dailyData2');
      location.reload();
    });
  });

  function applyFilter(days){
    sessionStorage.setItem('dailyFilterDays', String(days));
    render();
  }
  document.getElementById('btnFilter7').addEventListener('click',()=>applyFilter(7));
  document.getElementById('btnFilter14').addEventListener('click',()=>applyFilter(14));
  document.getElementById('btnFilter30').addEventListener('click',()=>applyFilter(30));

  // Modal (reuse style concept from index)
  function showClearModal(message,onConfirm){
    const modal=document.createElement('div');
    modal.className='modal-overlay';
    modal.innerHTML=`<div class="modal-content" style="max-width:340px;padding:28px;border-radius:22px;">
      <div class="modal-header" style="margin-bottom:16px;">
        <div class="modal-icon" style="background:linear-gradient(135deg,#fee2e2,#fecaca);width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M8 6v12"/><path d="M16 6v12"/><path d="M10 11h4"/></svg>
        </div>
        <h2 class="modal-title" style="font-size:18px;font-weight:700;margin:0;color:#0f172a;">ยืนยันการลบ</h2>
      </div>
      <p class="modal-message" style="font-size:14px;line-height:1.6;color:#64748b;margin-bottom:22px;text-align:center;">${message}</p>
      <div class="modal-actions" style="display:flex;gap:10px;">
        <button class="modal-btn modal-btn-cancel" style="flex:1;padding:11px 20px;border-radius:14px;background:#f1f5f9;color:#64748b;font-weight:600;font-size:14px;border:none;">ยกเลิก</button>
        <button class="modal-btn modal-btn-confirm" style="flex:1;padding:11px 20px;border-radius:14px;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;font-weight:600;font-size:14px;border:none;">ยืนยัน</button>
      </div>
    </div>`;
    document.body.appendChild(modal);
    modal.addEventListener('click',e=>{ if(e.target===modal){ modal.remove(); }});
    modal.querySelector('.modal-btn-cancel').addEventListener('click',()=>modal.remove());
    modal.querySelector('.modal-btn-confirm').addEventListener('click',()=>{ modal.remove(); onConfirm(); });
  }
})();
</script>
</body>
<script>
document.addEventListener('keydown', function(e) {
  if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
    e.preventDefault();
  }
});
</script>
</html>